{% extends "base.html" %}
{% block title %}Clipboard - ezkopy{% endblock %}
{% block content %}
<h1>ğŸ“‹ ezkopy</h1>
<p class="sub">Clipboard for <strong>{{ user.username }}</strong></p>

<textarea id="cb" placeholder="Paste text here...">{{ clipboard }}</textarea>

<div class="btns">
    <button class="pri" onclick="save()">ğŸ’¾ Save</button>
    <button class="sec" onclick="load()">ğŸ”„ Refresh</button>
    <button class="sec" onclick="copy()">ğŸ“‹ Copy to Local</button>
    <button class="sec" onclick="clr()">ğŸ—‘ï¸ Clear</button>
</div>

<div id="status"></div>

<div class="help">
    <h3>Terminal Usage</h3>
    {% if user.pin %}
    <p><b>With PIN:</b></p>
    <div class="cmd"><code>curl https://{{ host }}/u/{{ user.username }}/{{ user.pin }}/raw</code><button onclick="copyCmd(this)">ğŸ“‹</button></div>
    <div class="cmd"><code>curl -X POST -d "text" https://{{ host }}/u/{{ user.username }}/{{ user.pin }}/raw</code><button onclick="copyCmd(this)">ğŸ“‹</button></div>
    {% endif %}
    {% if user.whitelisted_ips %}
    <p><b>With whitelisted IP:</b></p>
    <div class="cmd"><code>curl https://{{ host }}/u/{{ user.username }}/raw</code><button onclick="copyCmd(this)">ğŸ“‹</button></div>
    <div class="cmd"><code>curl -X POST -d "text" https://{{ host }}/u/{{ user.username }}/raw</code><button onclick="copyCmd(this)">ğŸ“‹</button></div>
    {% endif %}
    {% if not user.pin and not user.whitelisted_ips %}
    <p style="color: #fca5a5;">âš ï¸ Configure PIN or IP whitelist in <a href="{{ url_for('settings') }}">Settings</a> to enable terminal access.</p>
    {% endif %}
</div>

<script>
    const $ = id => document.getElementById(id);
    const status = (msg, ok) => {
        $('status').textContent = msg;
        $('status').className = ok ? 'ok' : 'err';
        setTimeout(() => $('status').className = '', 3000);
    };
    
    async function save() {
        const t = $('cb').value;
        const r = await fetch('/raw', {method: 'POST', body: t});
        status(r.ok ? `Saved (${t.length} chars)` : 'Error', r.ok);
    }
    
    async function load() {
        const r = await fetch('/raw');
        $('cb').value = await r.text();
        status('Refreshed', true);
    }
    
    function copy() {
        navigator.clipboard.writeText($('cb').value)
            .then(() => status('Copied to local clipboard', true))
            .catch(() => status('Copy failed', false));
    }
    
    function clr() {
        $('cb').value = '';
        save();
    }
    
    function copyCmd(btn) {
        const code = btn.previousElementSibling.textContent;
        navigator.clipboard.writeText(code)
            .then(() => { btn.textContent = 'âœ“'; setTimeout(() => btn.textContent = 'ğŸ“‹', 1500); })
            .catch(() => status('Copy failed', false));
    }
</script>
{% endblock %}
